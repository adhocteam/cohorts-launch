- modalId = "#{action}-engagement-#{engagement.id.to_s + '-' unless action == 'create'}modal"
- formId = "#{action}-engagement-#{engagement.id.to_s + '-' unless action == 'create'}form"
.ui.modal{ id: modalId }
  .header= "#{action.capitalize} Engagement"
  .content
    - if action == 'show'
      %h4.ui.header Sessions
      %table.ui.sortable.striped.table
        %thead
          %tr
            %th Date and Time
            %th People
        %tbody
          - engagement.research_sessions.each do |session|
            %tr
              %td= session.datetime.strftime('%b %e, %Y at %l:%M %p')
              %td= session.people.map(&:full_name).join(', ')
      - unless engagement.search_query.blank?
        %h4.ui.header Search query
        .ui.grid
          .equal.width.row
            .column= engagement.search_query
          .equal.width.row
            .column= link_to 'Go to search', search_index_path(q: engagement.search_query), class: 'ui green button'
    - elsif action == 'destroy'
      = form_for engagement, method: :delete, format: :js, remote: true, html: { class: 'ui form', id: formId } do |f|
        %p Are you sure? This will delete the engagement along with all sessions.
    - else
      = form_for engagement, format: :js, remote: true, html: { class: 'ui form', id: formId } do |f|
        .field
          = f.label :client_id, 'Client'
          = f.select :client_id, Client.all.collect { |p| [ p.name, p.id ] }, {include_blank: true}, class: 'ui search selection dropdown'
        .field
          = f.label :topic
          = f.text_field :topic
        .two.fields
          .field
            = f.label :start_date
            .ui.calendar.range-start
              .ui.left.icon.input
                %i.calendar.icon
                = f.text_field :start_date
          .field
            = f.label :end_date
            .ui.calendar.range-end
              .ui.left.icon.input
                %i.calendar.icon
                = f.text_field :end_date
  .actions
    - unless action == 'show'
      %input.ui.button{ class: action == 'destroy' ? 'negative' : 'positive', type: 'submit', value: action.capitalize, form: formId }
    .ui.cancel.button Close
